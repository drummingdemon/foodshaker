<!DOCTYPE html>
<!--
    FoodShaker :: Cross-Platform Random Food Generator
    A Harvard University's CS50 Final Project
    by GÃ¡bor Hargitai
-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" href="css/onsenui.css">
        <link rel="stylesheet" href="css/onsen-css-components.css">
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/angular/angular.js"></script>
        <script type="text/javascript" src="js/onsenui.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/shake.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        <script type="text/javascript" src="js/SQLitePlugin.js"></script>
        <script src="js/controllers.js"></script>

        <script >
            ons.ready(function(){
                
                tabbar.on('postchange', function(event) {
                
                if (event.index === 0) {
                    shakeEnabled = true;
                    console.log("shaker opened");
                }
                 
                // Only with the tab we want, we can use the index or the name
                if (event.index === 1) {
                    shakeEnabled = false;
                    console.log("fridge opened");

                    // Delete this listener so it's only triggered the first time
                    //myTabbar.off('postchange');
                }
                if (event.index === 2) {
                    shakeEnabled = false;
                    console.log("settings opened");
                }

                });
            });
        </script>
        <script type="text/javascript" charset="utf-8">

        document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady() {
     
            console.log('Begin SQL Test');
  var db = window.sqlitePlugin.openDatabase("Database", "1.0", "PhoneGap Demo", 200000);
            console.log('database opened');  
            db.transaction(function(tx) {
                console.log('starting transaction');
            tx.executeSql('DROP TABLE IF EXISTS test_table');
            tx.executeSql('CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)');

            // demonstrate PRAGMA:
            db.executeSql("pragma table_info (test_table);", [], function(res) {
              console.log("PRAGMA res: " + JSON.stringify(res));
            });

            tx.executeSql("INSERT INTO test_table (data, data_num) VALUES (?,?)", ["test", 100], function(tx, res) {
              console.log("insertId: " + res.insertId + " -- probably 1");
              console.log("rowsAffected: " + res.rowsAffected + " -- should be 1");

              db.transaction(function(tx) {
                tx.executeSql("select count(id) as cnt from test_table;", [], function(tx, res) {
                  console.log("res.rows.length: " + res.rows.length + " -- should be 1");
                  console.log("res.rows.item(0).cnt: " + res.rows.item(0).cnt + " -- should be 1");
                });
              });

            }, function(e) {
              console.log("ERROR: " + e.message);
            });
          });

        }

        </script>
        
        
        
        
        
        
        
        <!-- // the script that handles the shake-motion detection !-->
        <script type="text/javascript" src="js/shake-alert.js"></script>
        <title>FoodShaker</title>
    </head>
    <body> 
        <ons-tabbar var="tabbar">
            <ons-tabbar-item
                icon="ion-refresh"
                label="Shake!"
                page="shake"
                active="true"></ons-tabbar-item>
            <ons-tabbar-item
                icon="ion-nuclear"
                label="Fridge"
                page="fridge"></ons-tabbar-item>
            <ons-tabbar-item
                icon="gear"
                label="Settings"
                page="settings"></ons-tabbar-item>
        </ons-tabbar>

        <ons-template id="shake">
            <ons-page id="shake-page">
                <div class="backdrop">
                    <div class="shake-icon"></div>
                    <div class="shake-text">Shake Me!</div>
                </div>
            </ons-page>
        </ons-template>
        
        <ons-modal var="modal" ng-controller="modalController">
            <ons-icon icon="ion-load-c" spin="true"></ons-icon>
            <br>
            <br> This is your recipe.
            <br>
            <br> Well, just a placeholder.
            <br>
            <br>Closing in 4 seconds.
            <br>
            <br>
            <ons-button ng-click="dismiss()">Close Manually</ons-button>
        </ons-modal>
        
        <ons-template id="fridge">
            <ons-page>
                <ons-toolbar>
                    <div class="center">Fridge</div>
                </ons-toolbar>    
                
                <br>
                <div class="shake-text">Currently, it's empty</div>
                <code ng-bind-html="messages"></code>
            </ons-page>
        </ons-template>
        
        <ons-template id="settings">
            <ons-page ng-controller="MyController">   
                <ons-toolbar>
                    <div class="center">Settings</div>
                </ons-toolbar>
                <br/>
                <div class="settings-header">Audio</div>
                <ons-list modifier="inset" class="settings-list">
                    <ons-list-item>
                        Enable Shaker Sound
                      <ons-switch modifier="list-item" var='audioSwitch' ng-model='audToggle' ng-change='check()'></ons-switch>
                    </ons-list-item>
                </ons-list>
                <br/>
                <div class="settings-header">General</div>
                <ons-list modifier="inset" class="settings-list">
                    <ons-list-item>
                        Online Database
                      <ons-switch modifier="list-item" var='onlineSwitch' ng-model='onlineToggle' ng-change='toggleOnline()'></ons-switch>
                    </ons-list-item>
                </ons-list>
                <br/>
                <div class="settings-header">Time Available for Cooking</div>
                <ons-list class="range-list">
                    <ons-list-item>
                    <ons-row>
                        <ons-col class="range-wrapper">
                             <center>{{timeToCook}} minutes</center>
                             <input type="range" value="30" class="range" ng-model="timeToCook" min=5 max=60 ng-change="setCookingTime()">
                        </ons-col>
                    </ons-row>
                    </ons-list-item>
                </ons-list>
            </ons-page>
        </ons-template>

    </body>
</html>
